@page "/"

@inject NavigationManager NavigationManager
@inject IConfiguration Configuration 

<div>
	<nav class="navbar">
		<div class="input-group mb-3">
			<input @bind-value="SearchPhrase" class="form-control me-2" type="text" placeholder="Search" aria-label="Search">
			<button class="btn btn-outline-success" @onclick="@(() => SearchSeries())">Search</button>
		</div>
	</nav>
	@foreach (var serie in Series)
	{
		<div @onclick="() => OnSerieSelection(serie)">
			<SerieInfoCard Serie=serie ShortDescription=true/>
		</div>
	}
</div>

@code {

	private TmdbManager _manager;

	public List<SerieModel> Series { get; set; } = new();

	public string SearchPhrase { get; set; }

	protected override void OnInitialized()
	{
		//SetFakeData();
		var token = Configuration["Api:tmdb_token"];
		_manager = new TmdbManager(token);
	}

	private void OnSerieSelection(SerieModel serie)
	{
		NavigationManager.NavigateTo($"/serie/{serie.Id}");
	}

	private async Task SearchSeries()
	{
		Series = new();
		Series = await _manager.GetSeriesByName(SearchPhrase);
	}

	private void SetFakeData()
	{
		Series = new()
		{
			new SerieModel
			{
				Id=1,
				Name="The Big Bang Theory",
				Description="Physicists Leonard and Sheldon find their nerd-centric social circle with pals Howard and Raj expanding when aspiring actress Penny moves in next door.",
				ReleaseDate=DateOnly.Parse("01.01.2007"),
				Cover="tbbt.jpg"
			},
			new SerieModel
			{
				Id=2,
				Name="The Boys",
				Description="A group of vigilantes known informally as “The Boys” set out to take down corrupt superheroes with no more than blue-collar grit and a willingness to fight dirty.",
				ReleaseDate=DateOnly.Parse("03.02.2019"),
				Cover="the_boys.jpg"
			},
		};
	}

}